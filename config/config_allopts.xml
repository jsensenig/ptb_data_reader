	<config>
    <Hardware>
      <!-- Number of clock cycles that any outgoing pulse is high -->
      <PulseWidth>2</PulseWidth>
    </Hardware>
    <DataBuffer>
      <DaqHost>localhost</DaqHost>
      <DaqPort>8992</DaqPort>
      <!-- Size of the ethernet packet in bytes is set by the 16-bit header register : 65535 bytes -->
      <!-- 28 bit rollover corresponds to approx. 17 s (2^29-1*32 ns). Plenty of time to accumulate data -->
      <!-- Rollover Parameter is the size of the packet that one can accumulate before sending. 
      MTU is usually 1500 bytes. Header and footer =  4 + 12 = 16 bytes + 4 bytes (checksum). 
      Typical packet size : ~128 bits = 16 bytes
      Reasonable guess for rollover: 80 (corresponds to a packet of 1280 bytes)
     -->
    <RollOver>80</RollOver>
    
    <!-- Size of the time slice that each packet should represent. Make sure to be smaller than the rollover of 28 bits. -->
    <!-- 28 bit rollover of a 64 MHz clock is about 8s. The packet size should never get that big.-->  
    <MicroSliceDuration>7</MicroSliceDuration>
  </DataBuffer>
    <debug>
      <!-- enable creation of a log file/DEBUG mode -->
      <enable>true</enable>
      <!-- store timestamp of command received in the log file -->
      <CmdTime>true</CmdTime>
    </debug>
    <ChannelMask>
      <!-- All 49 channels are on, encoded into a 64 bit hex word-->
      <!-- The code is on the LSB but the numbering starts from the MSB-->    
      <BSU>0x1FFFFFFFFFFFF</BSU>
      <!-- All 48 channels are on, encoded into a 64 bit hex word-->
      <TSU>0xFFFFFFFFFFFF</TSU>
    </ChannelMask>
    <MuonTriggers num_triggers="4">
      <!-- Number of clock cycles that the trigger out pulse is high -->
      <!-- <TrigOutWidth>0x2</TrigOutWidth> -->
      <!-- Number of clock cycles that each pulse should be extended to validate triggers -->
      <TriggerWindow>0x3</TriggerWindow>
      <!-- Number of clock cycles, after the trigger window, to lock the channel off -->
      <LockdownWindow>0xD</LockdownWindow>
      <!-- The trigger masks are complicated because it is an AND of the OR of each group, i.e. 
        trigger=AND(OR(grp1),OR(grp2)). We have to mask each group separately.
        This has to be serialized into a common string. Here only the streaming code is used -->
       
      <!-- The possible logic operations are: (0x0:AND , Ox1:OR, 0x2:XOR)-->
      <!-- Trigger A - one BSU counter in the RM1-16 series in coincidence with one BSU counter in the CL1-13 -->
      <!-- FIXME: These are the masks assuming the list as masked in the Excel sheet -->
      <TriggerMask id="A" mask="1000">
        <group1>
          <!-- The internal operation is between the channels of each group-->
          <Logic>0x2</Logic>
          <!-- RM 1-16 -->
          <BSU>0xFFFF</BSU>
          <TSU>0x0</TSU>
        </group1>
        <group2>
          <Logic>0x2</Logic>
          <!-- CL 1-13-->
          <BSU>0x7F7E000000</BSU>
          <TSU>0x0</TSU>
        </group2>
        <!-- The external operation is between the groups -->
        <ExtLogic>0x0</ExtLogic>
        <!-- Prescale : Number of triggers that are ignored after a successful one --> 
        <Prescale>0x0</Prescale>        
      </TriggerMask>
      <!-- Trigger B - any TSU counter from the NU1-6 series in coincidence with any TSU counter from the SL1-6 series.-->
      <TriggerMask id="B"  mask="0100">
        <group1>
          <!-- The possible operations are: (0x0:AND , Ox1:OR, 0x2:XOR)-->
          <!-- The internal operation is between the channels of each group-->
          <Logic>0x1</Logic>
          <!-- NU 1-6 -->
          <BSU>0x0</BSU>
          <TSU>0x3F000000</TSU>
        </group1>
        <group2>
          <Logic>0x1</Logic>
          <!-- SL 1-6-->
          <BSU>0x0</BSU>
          <TSU>0xFC0000000</TSU>
        </group2>
        <!-- The external operation is between the groups -->
        <ExtLogic>0x0</ExtLogic>
        <!-- Prescale : Number of triggers that are ignored after a successful one --> 
        <Prescale>0x0</Prescale>
      </TriggerMask>
      <!-- Trigger C - any TSU counter from the SU1-6 series in coincidence with any TSU counter from the NL1-6 series. -->
      <TriggerMask id="C"  mask="0010">
        <group1>
          <Logic>0x1</Logic>
          <!-- SU 1-6 -->
          <BSU>0x0</BSU>
          <TSU>0xFC0000000000</TSU>
        </group1>
        <group2>
          <Logic>0x1</Logic>
          <!-- NL 1-6-->
          <BSU>0x0</BSU>
          <TSU>0x3F000000000</TSU>
        </group2>
        <ExtLogic>0x0</ExtLogic>
        <!-- Prescale : Number of triggers that are ignored after a successful one --> 
        <Prescale>0x0</Prescale>
      </TriggerMask>
      <!-- Trigger D - any TSU counter from the EL1-10 series in coincidence with any TSU counter from the WU1-10 series. -->
      <TriggerMask id="D"  mask="0001">
        <group1>
          <Logic>0x1</Logic>
          <!-- EL 1-10 -->
          <BSU>0x0</BSU>
          <TSU>0x7FE00</TSU>
        </group1>
        <group2>
          <Logic>0x1</Logic>
          <!-- WU 1-10 -->
          <BSU>0x0</BSU>
          <TSU>0x1FF</TSU>
        </group2>
        <ExtLogic>0x0</ExtLogic>
        <!-- Prescale : Number of triggers that are ignored after a successful one --> 
        <Prescale>0x0</Prescale>
      </TriggerMask>
      <!-- Expected trigger rates for these : Trigger A = 60 Hz, Trigger B+C+D = 2-3 Hz -->
    </MuonTriggers>
    <ExtTriggers>
      <!-- Mask of the external triggers. There are 4 independent and 8 ored, so 5 bits. Defaults to all on -->
      <Mask>0xF</Mask>
      <!-- Echo triggers indicates if a TrigOut should be sent to the other systems -->
      <EchoTriggers>false</EchoTriggers>
    </ExtTriggers>
    <Calibrations>
      <CalibrationMask id="C1" mask="1000">
      <enabled>false</enabled>
      <!-- Number of clock ticks between calibration pulses -->
      <period>0xA</period>
      </CalibrationMask>
      <CalibrationMask id="C2" mask="0100">
      <enabled>false</enabled>
      <!-- Number of clock ticks between calibration pulses -->
      <period>0xA</period>
      </CalibrationMask>
      <CalibrationMask id="C3" mask="0010">
      <enabled>false</enabled>
      <!-- Number of clock ticks between calibration pulses -->
      <period>0xA</period>
      </CalibrationMask>
      <CalibrationMask id="C4" mask="0001">
      <enabled>false</enabled>
      <!-- Number of clock ticks between calibration pulses -->
      <period>0xA</period>
      </CalibrationMask>
    </Calibrations>
	</config>
	
	<command>
		<!-- Set Run to start. Reset everything and start clock with the next sync -->
		<StartRun></StartRun>
		<!-- Set Run to stop. When next sync comes, stop reading data. Data already in buffers is still sent --> 
		<StopRun></StopRun>
		<SelfTest></SelfTest>
	</command>
